@model CapoteSolution.Web.Models.ViewModels.CopierDisplayVM

@{
    ViewData["Title"] = "Detalles de Impresora";
}

<div class="card">
    <div class="card-header bg-primary text-white">
        <h3>@ViewData["Title"] - @Model.SerialNumber</h3>
    </div>
    <div class="card-body">
        <dl class="row">
            <dt class="col-sm-4">Estado:</dt>
            <dd class="col-sm-8">
                <span class="badge @(Model.Status == CapoteSolution.Models.Entities.ContractStatus.Active.ToString() ? "bg-success" : "bg-warning")">
                    @Model.Status
                </span>
            </dd>

            
            <dt class="col-sm-4">Plan B/N:</dt>
            <dd class="col-sm-8">@Model.PlanBW copias/mes</dd>

            <dt class="col-sm-4">Plan Color:</dt>
            <dd class="col-sm-8">@Model.PlanColor copias/mes</dd>

            <dt class="col-sm-4">Precio Extra B/N:</dt>
            <dd class="col-sm-8">@Model.Extra.ToString("C") por copia</dd>

            <dt class="col-sm-4">Precio Mensual</dt>
            <dd class="col-sm-8">$ @Model.MonthlyPrice</dd>
        </dl>
    </div>
</div>

<!-- Pestañas de servicios -->
@{
    var serviceMonthlyCounter = ViewBag.ServiceMonthlyCounter as IEnumerable<CapoteSolution.Models.Entities.Service>;
    var serviceTonerChange = ViewBag.TonerChange as IEnumerable<CapoteSolution.Models.Entities.Service>;
    var serviceMaintenance = ViewBag.ServiceMaintenance as IEnumerable<CapoteSolution.Models.Entities.Service>;
}

<ul class="nav nav-tabs" id="servicesTab" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active" id="toner-tab" data-bs-toggle="tab" data-bs-target="#toner" type="button" role="tab" aria-controls="toner" aria-selected="true">
            Cambios de Tóner
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="maintenance-tab" data-bs-toggle="tab" data-bs-target="#maintenance" type="button" role="tab" aria-controls="maintenance" aria-selected="false">
            Mantenimientos
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="other-tab" data-bs-toggle="tab" data-bs-target="#other" type="button" role="tab" aria-controls="other" aria-selected="false">
            Otros Servicios
        </button>
    </li>
</ul>

<div class="tab-content p-3 border border-top-0 rounded-bottom" id="servicesTabContent">
    <!-- Tab de Cambios de Tóner -->
    <div class="tab-pane fade show active" id="toner" role="tabpanel" aria-labelledby="toner-tab">
        @if (serviceTonerChange != null && serviceTonerChange.Any())
        {
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Fecha</th>
                        <th>Tóner Color</th>
                        <th>Tóner B/N</th>
                        <th>Técnico</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var change in serviceTonerChange)
                    {
                        var viewModelUser = new CapoteSolution.Web.Models.ViewModels.UserDisplayVM();
                        viewModelUser.Import(change.Technician);

                        <tr>
                            <td>@change.Date.ToString("dd/MM/yyyy")</td>
                            <td>@change.ColorCounter</td>
                            <td>@change.BlackCounter</td>
                            <td>@viewModelUser.FullName</td>
                        </tr>
                    }
                </tbody>
            </table>
        }
        else
        {
            <div class="alert alert-info">No hay registros de cambios de tóner.</div>
        }
    </div>

    <!-- Tab de Mantenimientos -->
    <div class="tab-pane fade" id="maintenance" role="tabpanel" aria-labelledby="maintenance-tab">
        @if (serviceMaintenance!= null && serviceMaintenance.Any())
        {
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Fecha</th>                        
                        <th>Técnico</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var maintenance in serviceMaintenance)
                    {
                        var viewModelUser = new CapoteSolution.Web.Models.ViewModels.UserDisplayVM();
                        viewModelUser.Import(maintenance.Technician);
                        <tr>
                            <td>@maintenance.Date.ToString("dd/MM/yyyy")</td>
                            <td>@viewModelUser.FullName</td>
                        </tr>
                    }
                </tbody>
            </table>
        }
        else
        {
            <div class="alert alert-info">No hay registros de mantenimientos.</div>
        }
    </div>

    <!-- Tab de Otros Servicios -->
    <div class="tab-pane fade" id="other" role="tabpanel" aria-labelledby="other-tab">
        @if (serviceMonthlyCounter != null && serviceMonthlyCounter.Any())
        {
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Fecha</th>
                        <th>Contador Negro</th>                         
                        <th>Contador Color</th>
                        <th>Técnico</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var service in serviceMonthlyCounter)
                    {
                        var viewModelUser = new CapoteSolution.Web.Models.ViewModels.UserDisplayVM();
                        var viewModelService = new CapoteSolution.Web.Models.ViewModels.ServiceDisplayVM();
                        viewModelService.Import(service);
                        viewModelUser.Import(service.Technician);

                        <tr>
                            <td>@viewModelService.ServiceDate.ToString("dd/MM/yyyy")</td>
                            <td>@viewModelService.BlackCounter</td>                            
                            <td>@viewModelService.ColorCounter</td>
                            <td>@viewModelService.TechnicianName</td>
                        </tr>
                    }
                </tbody>
            </table>
        }
        else
        {
            <div class="alert alert-info">No hay registros de otros servicios.</div>
        }
    </div>
</div>

<a asp-action="Index" class="btn btn-secondary mt-3">Volver al Listado</a>